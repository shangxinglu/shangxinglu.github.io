# 了解一下JavaScript运行一段代码的过程(ES5)

```javascript
var v1 = 'global var';
let k1 = 'global let';

function f1(){
    var v2 = 'scope';
    let k2 = 'scopd';
}

f1();

```
我们来看先上述代码运行的过程
1. 首先会先创建一个全局上下文
2. 在全局上文中的的全局环境记录中添加一个标识符v1并为其赋值
3. 在全局上文中的的全局环境记录中添加一个标识符k1并为其赋值
4. 在全局上文中的的全局环境记录中添加函数f1
5. 执行f1时会创建一个新的执行上下文f1 Context，并放入执行上下文堆栈顶，f1 Context的outer指向全局上下文
6. 然后在f1 Context中的函数环境记录添加一个标识符v2并为其赋值
7. 在f1 Context中的函数环境记录添加一个标识符k2并为其赋值
8. f1运行结束后，f1 Context会从执行上下文堆栈中移除
9. 紧接着全局上下文也会被移除，运行结束


<br/>


## 头脑风暴
<br/>

### 执行上下文是什么
<br/>
执行上下文的就是一个运行环境，存有当前上下文内的参数、变量、函数、this以及外部作用域指针outer，执行上下文有多个，存放在执行上下文堆栈

执行上下文根据场景可以分为4种
1. 全局初始化
2. 模块初始化
3. 实例化函数环境
4. 实例化Eval环境


<br/>
<br/>

### 执行上下文有什么组成
<br/>

执行上下文有词法环境和变量环境还有一个[[ThisBinding]]，词法环境(LexicalEnvironment)与变量环境(VariableEnvironment)的区别在于通过不同的声明语法而创建,其实都是词法环境(Lexical Environment)


变量环境(VariableEnvironment)就是由VariableStatement创建绑定的词法环境

词法环境(LexicalEnvironment)是由let，const，class创建绑定的词法环境
<br/>
<br/>

### 词法环境(Lexical Environment)是如何记录数据的

词法环境有两个部分组成，环境记录和外部指针

环境记录其实是一个Record抽象类，它有3个子类:
1. 全局环境记录
2. 声明性环境记录
3. 对象环境记录

声明性环境记录也有2个子类:
1. 函数环境记录
2. 模块环境记录

<br/>

### 全局环境记录
<br/>

全局环境记录其实是一个复合环境记录，由对象环境记录和声明性环境记录封装而成，用来表示最外部作用域，同时为内置的全局变量、全局对象的属性及脚本中的所有顶级声明提供了绑定

<br/>

### 对象环境记录
<br/>

每个环境记录都都与一个称为其绑定对象的对象相关联，
对象环境记录绑定直接与其绑定对象的属性名称相对应的一组字符串标识符名称，不是以IdentifierName形式出现的字符串的属性键不包含在绑定标识符集中

如果对象环境记录为with语句创建时，可以提供其绑定对象作为this值的隐式调用，这个功能由每个对象环境记录的withEnvironment布尔值控制，默认false

<br/>


### 声明性环境记录

<br/>
声明性环境记录绑定其范围内包含的声明定义的标识符集

<br/>
<br/>

### 模块环境记录

<br/>

用来标识ECMAScript模块的外部范围


<br/>

### 函数环境记录
<br/>
用于表示函数的顶级范围


